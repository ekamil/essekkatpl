include Makefile

SSH_HOST := hertz
URL      := http://www1.hertz.megiteam.pl 

WWW_PATH := ~/essekkat.pl
DEB_PATH := ~/deb.essekkat.pl
DEB_LOCAL:= ~/public_html/debian

deploy: _site
	sed -i 's|site.url = .*|site.url = "$(URL)"|' _config.py
	$(RSYNC) --exclude 'debian/' _site/ $(SSH_HOST):$(WWW_PATH)/
	ssh $(SSH_HOST) 'mkdir -p $(DEB_PATH)/dists/ $(DEB_PATH)/pool/'
	$(RSYNC) $(DEB_LOCAL)/dists/ $(SSH_HOST):$(DEB_PATH)/dists/
	$(RSYNC) $(DEB_LOCAL)/pool/ $(SSH_HOST):$(DEB_PATH)/pool/
	ssh $(SSH_HOST) 'chmod -R 755 $(WWW_PATH)'
	ssh $(SSH_HOST) 'chmod -R 755 $(DEB_PATH)'

clean-remote:
	ssh $(SSH_HOST) 'rm -r $(WWW_PATH)/*'
	ssh $(SSH_HOST) 'rm -r $(DEB_PATH)/*'
